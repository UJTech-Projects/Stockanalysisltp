name: Scheduled Jobs

on:
  schedule:
    # 1. Token Refresh: Every 6 hours
    - cron: '0 */6 * * *'
    
    # 2. Fetch LTP: Daily after market close (10:00 UTC = 15:30 IST)
    - cron: '0 10 * * *'
    
    # 3. Resubscribe: Daily morning before market open (03:15 UTC = 08:45 IST)
    - cron: '15 3 * * *'

jobs:
  trigger-jobs:
    runs-on: ubuntu-latest
    steps:
      - name: Run Token Refresh
        if: github.event.schedule == '0 */6 * * *'
        run: curl -f --retry 3 --retry-connrefused --max-time 60 -X POST ${{ secrets.RENDER_APP_URL }}/jobs/refresh-token

      - name: Run Fetch LTP
        if: github.event.schedule == '0 10 * * *'
        run: curl -f --retry 3 --retry-connrefused --max-time 60 -X POST ${{ secrets.RENDER_APP_URL }}/jobs/fetch-ltp

      - name: Run Resubscribe
        if: github.event.schedule == '15 3 * * *'
        run: curl -f --retry 3 --retry-connrefused --max-time 60 -X POST ${{ secrets.RENDER_APP_URL }}/jobs/resubscribe
